#include "diode.h"

// DT-670
code u16 usr1_temp[100] = {3000, 2900, 2800, 2730, 2700, 2600, 2500, 2400, 2300, 2200, 2100, 2000, 1900, 1800, 1700, 1600,
                           1500, 1400, 1300, 1200, 1100, 1000, 900, 850, 800, 773, 750, 700, 650, 600, 580, 560, 540, 520,
                           500, 480, 460, 440, 420, 400, 390, 380, 370, 360, 350, 340, 330, 320, 310, 300, 290, 280, 270,
                           260, 250, 240, 230, 220, 210, 200, 195, 190, 185, 180, 175, 170, 165, 160, 155, 150, 145, 140,
                           135, 130, 125, 120, 115, 110, 105, 100, 95, 90, 85, 80, 75, 70, 65, 60, 58, 56, 54, 52, 50, 48,
                           46, 44, 42, 40, 39, 38};
code u16 usr1_volt[100] = {5600, 5830, 6060, 6210, 6280, 6510, 6730, 6960, 7180,
                           7400, 7620, 7840, 8050, 8270, 8480, 8690, 8890, 9090,
                           9290, 9490, 9680, 9870, 10050, 10140, 10230, 10280, 10320,
                           10400, 10490, 10570, 10600, 10630, 10670, 10700, 10730, 10760,
                           10790, 10830, 10860, 10890, 10910, 10920, 10940, 10960, 10970,
                           10990, 11010, 11020, 11040, 11060, 11080, 11100, 11130, 11160,
                           11190, 11260, 11410, 11630, 11820, 11980, 12050, 12130, 12210,
                           12280, 12360, 12440, 12520, 12600, 12680, 12760, 12850, 12940,
                           13040, 13140, 13240, 13350, 13460, 13580, 13710, 13840, 13980,
                           14120, 14270, 14440, 14610, 14790, 14970, 15150, 15230, 15300,
                           15370, 15440, 15510, 15580, 15650, 15720, 15780, 15850, 15880,
                           15910};
// DT-400
code u16 usr2_temp[88] = {3000, 2900, 2800, 2700, 2600, 2500, 2400, 2300, 2200, 2100, 2000, 1900, 1800, 1700, 1600, 1500,
                          1400, 1300, 1200, 1100, 1000, 950, 900, 850, 800, 750, 700, 650, 600, 580, 560, 540, 520, 500, 480,
                          460, 440, 420, 400, 380, 360, 340, 320, 300, 290, 280, 270, 260, 250, 240, 230, 220, 210, 200, 195,
                          190, 185, 180, 175, 170, 165, 160, 155, 150, 145, 140, 135, 130, 125, 120, 115, 110, 105, 100, 95,
                          90, 85, 80, 75, 70, 65, 60, 55, 50, 48, 46, 44, 42};
code u16 usr2_volt[88] = {5190, 5430, 5670, 5910, 6150, 6380, 6620, 6860, 7090,
                          7320, 7560, 7790, 8010, 8240, 8470, 8690, 8910, 9120,
                          9340, 9550, 9760, 9860, 9960, 10060, 10150, 10250, 10340,
                          10440, 10530, 10560, 10600, 10630, 10670, 10710, 10740, 10770,
                          10810, 10840, 10880, 10910, 10950, 10990, 11030, 11070, 11090,
                          11120, 11150, 11190, 11250, 11360, 11560, 11770, 11960, 12140,
                          12230, 12320, 12410, 12490, 12580, 12670, 12760, 12850, 12950,
                          13040, 13140, 13240, 13350, 13450, 13560, 13680, 13800, 13930,
                          14060, 14200, 14350, 14500, 14670, 14840, 15030, 15220, 15410,
                          15600, 15790, 15980, 16050, 16120, 16190, 16260};

// void calc_indices(u16 setpoint) {

// }

u16 trans_table(u16 volt, u8 diode)
{
    if (diode) // DT-400
    {
        u16 res = linear(usr2_volt, usr2_temp, 88, volt);
        return res;
    }
    else
    {
        u16 res = linear(usr1_volt, usr1_temp, 100, volt);
        return res;
    }
}

//估算温度
// u16 trans_table(int volt, u8 table_ind)
// {
//     if (table_ind) //DT-400
//     {
//         u8 i = 0;
//         for (i = 0; i < 88; i++)
//         {
//             if (volt >= usr2_volt[i])
//             {
//                 return usr2_temp[i];
//             }
//         }
//     }
//     else
//     {
//         u8 i = 0;
//         for (i = 0; i < 100; i++)
//         {
//             if (volt >= usr1_volt[i])
//             {
//                 return usr1_temp[i];
//             }
//         }
//     }

//     return 0;
// }

// void calc_indices(u16 setpoint)
// {
//     if (diode) //DT-400
//     {
//         u8 i = 0;
//         for (i = 0; i < 88; i++)
//         {
//             if (setpoint <= usr2_temp[i])
//             {
//                 int i, y;
//                 u16 xArr[3];
//                 u16 yArr[3];
//                 int n = usr2_volt[i - 1] - usr2_volt[i + 1];
//                 xArr[0] = usr2_volt[i - 1];
//                 xArr[1] = usr2_volt[i];
//                 xArr[2] = usr2_volt[i + 1];
//                 yArr[0] = usr2_temp[i - 1];
//                 yArr[1] = usr2_temp[i];
//                 yArr[2] = usr2_temp[i + 1];
//                 for (i = 0; i < n; i++)
//                 {
//                     y = linear(xArr, yArr, 3, usr2_volt[i - 1] + i);
//                     calc_volt_indice[i] = usr2_volt[i - 1] + i;
//                     calc_temp_indice[i] = y;
//                 }
//                 calc_volt_indice[n] = 30605; //结束标志
//             }
//         }
//     }
//     else // DT-670
//     {
//         u8 i = 0;
//         for (i = 0; i < 100; i++)
//         {
//             if (setpoint <= usr1_temp[i])
//             {
//                 int i, y;
//                 u16 xArr[3];
//                 u16 yArr[3];
//                 int n = usr1_volt[i - 1] - usr1_volt[i + 1];
//                 xArr[0] = usr1_volt[i - 1];
//                 xArr[1] = usr1_volt[i];
//                 xArr[2] = usr1_volt[i + 1];
//                 yArr[0] = usr1_temp[i - 1];
//                 yArr[1] = usr1_temp[i];
//                 yArr[2] = usr1_temp[i + 1];
//                 for (i = 0; i < n; i++)
//                 {
//                     y = linear(xArr, yArr, 3, usr1_volt[i - 1] + i);
//                     calc_volt_indice[i] = usr1_volt[i - 1] + i;
//                     calc_temp_indice[i] = y;
//                 }
//                 calc_volt_indice[n] = 30605; //结束标志
//             }
//         }
//     }
// }

// u16 find_temp(u16 volt)
// {
//     u8 i = 0;
//     while ((volt != calc_volt_indice[i]))
//     {
//         i++;
//         if (calc_volt_indice[i] == 30605)
//         {
//             return trans_table(volt, diode);
//         }
//     }
//     return calc_temp_indice[i];
// }
